// Code generated by smithy-go-codegen DO NOT EDIT.

package pi

import (
	"context"
	awsmiddleware "github.com/aws/aws-sdk-go-v2/aws/middleware"
	"github.com/aws/aws-sdk-go-v2/aws/retry"
	"github.com/aws/aws-sdk-go-v2/aws/signer/v4"
	"github.com/aws/aws-sdk-go-v2/service/pi/types"
	smithy "github.com/awslabs/smithy-go"
	"github.com/awslabs/smithy-go/middleware"
	smithyhttp "github.com/awslabs/smithy-go/transport/http"
	"time"
)

// Retrieve Performance Insights metrics for a set of data sources, over a time
// period. You can provide specific dimension groups and dimensions, and provide
// aggregation and filtering criteria for each group.
func (c *Client) GetResourceMetrics(ctx context.Context, params *GetResourceMetricsInput, optFns ...func(*Options)) (*GetResourceMetricsOutput, error) {
	stack := middleware.NewStack("GetResourceMetrics", smithyhttp.NewStackRequest)
	options := c.options.Copy()
	for _, fn := range optFns {
		fn(&options)
	}
	addawsAwsjson11_serdeOpGetResourceMetricsMiddlewares(stack)
	awsmiddleware.AddRequestInvocationIDMiddleware(stack)
	smithyhttp.AddContentLengthMiddleware(stack)
	AddResolveEndpointMiddleware(stack, options)
	v4.AddComputePayloadSHA256Middleware(stack)
	retry.AddRetryMiddlewares(stack, options)
	addHTTPSignerV4Middleware(stack, options)
	awsmiddleware.AddAttemptClockSkewMiddleware(stack)
	addClientUserAgent(stack)
	smithyhttp.AddErrorCloseResponseBodyMiddleware(stack)
	smithyhttp.AddCloseResponseBodyMiddleware(stack)
	addOpGetResourceMetricsValidationMiddleware(stack)
	stack.Initialize.Add(newServiceMetadataMiddleware_opGetResourceMetrics(options.Region), middleware.Before)

	for _, fn := range options.APIOptions {
		if err := fn(stack); err != nil {
			return nil, err
		}
	}
	handler := middleware.DecorateHandler(smithyhttp.NewClientHandler(options.HTTPClient), stack)
	result, metadata, err := handler.Handle(ctx, params)
	if err != nil {
		return nil, &smithy.OperationError{
			ServiceID:     ServiceID,
			OperationName: "GetResourceMetrics",
			Err:           err,
		}
	}
	out := result.(*GetResourceMetricsOutput)
	out.ResultMetadata = metadata
	return out, nil
}

type GetResourceMetricsInput struct {
	// The granularity, in seconds, of the data points returned from Performance
	// Insights. A period can be as short as one second, or as long as one day (86400
	// seconds). Valid values are:  <ul> <li> <p> <code>1</code> (one second)</p> </li>
	// <li> <p> <code>60</code> (one minute)</p> </li> <li> <p> <code>300</code> (five
	// minutes)</p> </li> <li> <p> <code>3600</code> (one hour)</p> </li> <li> <p>
	// <code>86400</code> (twenty-four hours)</p> </li> </ul> <p>If you don't specify
	// <code>PeriodInSeconds</code>, then Performance Insights will choose a value for
	// you, with a goal of returning roughly 100-200 data points in the response.</p>
	PeriodInSeconds *int32
	// The maximum number of items to return in the response. If more items exist than
	// the specified MaxRecords value, a pagination token is included in the response
	// so that the remaining results can be retrieved.
	MaxResults *int32
	// The AWS service for which Performance Insights will return metrics. The only
	// valid value for ServiceType is: RDS
	ServiceType types.ServiceType
	// The date and time specifying the beginning of the requested time series data.
	// You can't specify a StartTime that's earlier than 7 days ago. The value
	// specified is inclusive - data points equal to or greater than StartTime will be
	// returned. The value for StartTime must be earlier than the value for EndTime.
	StartTime *time.Time
	// An optional pagination token provided by a previous request. If this parameter
	// is specified, the response includes only records beyond the token, up to the
	// value specified by MaxRecords.
	NextToken *string
	// An array of one or more queries to perform. Each query must specify a
	// Performance Insights metric, and can optionally specify aggregation and
	// filtering criteria.
	MetricQueries []*types.MetricQuery
	// The date and time specifiying the end of the requested time series data. The
	// value specified is exclusive - data points less than (but not equal to) EndTime
	// will be returned. The value for EndTime must be later than the value for
	// StartTime.
	EndTime *time.Time
	// An immutable, AWS Region-unique identifier for a data source. Performance
	// Insights gathers metrics from this data source. To use an Amazon RDS instance as
	// a data source, you specify its DbiResourceId value - for example:
	// db-FAIHNTYBKTGAUSUZQYPDS2GW4A
	Identifier *string
}

type GetResourceMetricsOutput struct {
	// An optional pagination token provided by a previous request. If this parameter
	// is specified, the response includes only records beyond the token, up to the
	// value specified by MaxRecords.
	NextToken *string
	// An array of metric results,, where each array element contains all of the data
	// points for a particular dimension.
	MetricList []*types.MetricKeyDataPoints
	// An immutable, AWS Region-unique identifier for a data source. Performance
	// Insights gathers metrics from this data source. To use an Amazon RDS instance as
	// a data source, you specify its DbiResourceId value - for example:
	// db-FAIHNTYBKTGAUSUZQYPDS2GW4A
	Identifier *string
	// The start time for the returned metrics, after alignment to a granular boundary
	// (as specified by PeriodInSeconds). AlignedStartTime will be less than or equal
	// to the value of the user-specified StartTime.
	AlignedStartTime *time.Time
	// The end time for the returned metrics, after alignment to a granular boundary
	// (as specified by PeriodInSeconds). AlignedEndTime will be greater than or equal
	// to the value of the user-specified Endtime.
	AlignedEndTime *time.Time

	// Metadata pertaining to the operation's result.
	ResultMetadata middleware.Metadata
}

func addawsAwsjson11_serdeOpGetResourceMetricsMiddlewares(stack *middleware.Stack) {
	stack.Serialize.Add(&awsAwsjson11_serializeOpGetResourceMetrics{}, middleware.After)
	stack.Deserialize.Add(&awsAwsjson11_deserializeOpGetResourceMetrics{}, middleware.After)
}

func newServiceMetadataMiddleware_opGetResourceMetrics(region string) awsmiddleware.RegisterServiceMetadata {
	return awsmiddleware.RegisterServiceMetadata{
		Region:        region,
		ServiceID:     ServiceID,
		SigningName:   "pi",
		OperationName: "GetResourceMetrics",
	}
}

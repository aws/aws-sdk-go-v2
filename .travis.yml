language: go
sudo: true
dist: bionic

os:
    - linux
    - osx
go:
    - 1.15.x
    - tip

script:
    make ci-test-no-generate;

before_install:
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then choco install make; fi

matrix:
  allow_failures:
      - go: tip

  include:
    - language: go
      os: windows
      go: 1.15.x
      script:
        - make ci-test-no-generate

    - language: java
      jdk: openjdk8
      before_script:
          - rm -rf /tmp/smithy-go
          - git clone https://github.com/awslabs/smithy-go /tmp/smithy-go
          - pushd /tmp/smithy-go/codegen
          - ./gradlew clean publishToMavenLocal -Plog-tests
          - popd
      script:
          - make smithy-generate # generation is not stable ci-test-generate-validate

    - language: java
      jdk: openjdk11
      before_script:
          - rm -rf /tmp/smithy-go
          - git clone https://github.com/awslabs/smithy-go /tmp/smithy-go
          - pushd /tmp/smithy-go/codegen
          - ./gradlew clean publishToMavenLocal -Plog-tests
          - popd
      script:
          - make smithy-generate # generation is not stable ci-test-generate-validate

branches:
  only:
    - master
    - feature/SmithyAPIClient
